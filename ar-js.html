<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>AR.js Hiro – Simple Marker Tracking (sichtbarer Kamerafeed)</title>
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.5/aframe/build/aframe-ar.js"></script>
  <style>
    html, body { margin: 0; padding: 0; height: 100%; background: #000; overflow: hidden; }
    /* HUD oberhalb von Canvas */
    .hud {
      position: fixed; left: 0; right: 0; top: 0;
      display: flex; gap: 8px; align-items: center; padding: 10px;
      background: rgba(0,0,0,0.35); color: #fff; font: 14px system-ui; z-index: 20;
    }
    .hud select, .hud button, .hud label { padding: 6px 10px; border: 0; border-radius: 8px; }
    .hud select { background: #111; color: #fff; }
    .hud button { background: #fff; color: #111; cursor: pointer; }
    .hud label { background: #111; color: #fff; cursor: pointer; }

    .hint {
      position: fixed; left: 0; right: 0; bottom: 0;
      padding: 10px; text-align: center;
      background: rgba(0,0,0,0.35); color: #fff; font: 12px system-ui; z-index: 20;
    }

    /* Wichtig: Video hinter Canvas, beide füllen den Viewport */
    #arjs-video, video[playsinline] {
      position: fixed; inset: 0;
      width: 100vw !important; height: 100vh !important;
      object-fit: contain !important; /* Standard = alles sichtbar */
      background: #000 !important;
      z-index: 0;
    }
    canvas.a-canvas {
      position: fixed; inset: 0;
      width: 100vw !important; height: 100vh !important;
      display: block; background: transparent !important;
      z-index: 10;
    }
  </style>
</head>
<body>
  <div class="hud">
    <span>Modell:</span>
    <select id="modelSelect">
      <option value="s1">s1 – Duck.glb</option>
      <option value="s2">s2 – DamagedHelmet.glb</option>
      <option value="s3">s3 – Sponza.gltf</option>
      <option value="p1">Platzhalter 1</option>
    </select>
    <button id="resetBtn">Neu zentrieren</button>
    <label><input type="checkbox" id="fitToggle" /> Video: cover</label>
  </div>

  <div class="hint">
    Richte die Kamera auf den <strong>Hiro-Marker</strong>. Seite per HTTPS ausliefern.
  </div>

  <a-scene
    embedded
    vr-mode-ui="enabled: false"
    renderer="alpha: true; antialias: true; logarithmicDepthBuffer: true"
    arjs="sourceType: webcam; facingMode: environment; detectionMode: mono_and_matrix; matrixCodeType: 3x3; debugUIEnabled: false; sourceWidth:1920; sourceHeight:1080; displayWidth:1920; displayHeight:1080"
  >
    <a-assets timeout="30000" crossorigin="anonymous">
      <a-asset-item id="s1" src="https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Assets/main/Models/Duck/glTF-Binary/Duck.glb"></a-asset-item>
      <a-asset-item id="s2" src="https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Assets/main/Models/DamagedHelmet/glTF-Binary/DamagedHelmet.glb"></a-asset-item>
      <a-asset-item id="s3" src="https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Assets/main/Models/Sponza/glTF/Sponza.gltf"></a-asset-item>
    </a-assets>

    <!-- Hiro Marker -->
    <a-marker type="pattern" preset="hiro" id="hiroMarker">
      <a-entity id="modelContainer"></a-entity>
    </a-marker>

    <!-- Kamera (FOV leicht enger, damit Modelle nicht winzig wirken) -->
    <a-entity camera="fov: 80"></a-entity>
  </a-scene>

  <script>
    const MODEL_CONFIGS = {
      s1: { src: '#s1', pos: '0 0 0', rot: '270 0 0', scale: '0.5 0.5 0.5' },
      s2: { src: '#s2', pos: '0 0 0', rot: '270 0 0', scale: '1 1 1' },
      s3: { src: '#s3', pos: '0 0 0', rot: '270 0 0', scale: '0.01 0.01 0.01' },
      p1: { src: 'https://example.com/DEIN-MODELL.glb', pos: '0 0 0', rot: '270 0 0', scale: '0.2 0.2 0.2' }
    };

    const modelSelect = document.getElementById('modelSelect');
    const resetBtn = document.getElementById('resetBtn');
    const fitToggle = document.getElementById('fitToggle');
    const container = document.getElementById('modelContainer');

    function loadModel(key) {
      const cfg = MODEL_CONFIGS[key];
      if (!cfg) return;
      while (container.firstChild) container.removeChild(container.firstChild);
      const e = document.createElement('a-entity');
      e.setAttribute('gltf-model', cfg.src);
      e.setAttribute('position', cfg.pos);
      e.setAttribute('rotation', cfg.rot);
      e.setAttribute('scale', cfg.scale);
      container.appendChild(e);
      modelSelect.value = key;
    }

    function resetModel() {
      const key = modelSelect.value;
      const cfg = MODEL_CONFIGS[key];
      if (!cfg) return;
      const model = container.firstChild;
      if (!model) return;
      model.setAttribute('position', cfg.pos);
      model.setAttribute('rotation', cfg.rot);
      model.setAttribute('scale', cfg.scale);
    }

    function applyVideoStyles(mode = 'contain') {
      const v = document.querySelector('#arjs-video') || document.querySelector('video');
      const c = document.querySelector('canvas.a-canvas');
      if (v) {
        v.setAttribute('playsinline', '');
        v.style.position = 'fixed';
        v.style.inset = '0';
        v.style.width = '100vw';
        v.style.height = '100vh';
        v.style.objectFit = mode; // 'contain' oder 'cover'
        v.style.background = '#000';
        v.style.zIndex = '0';
      }
      if (c) {
        c.style.position = 'fixed';
        c.style.inset = '0';
        c.style.width = '100vw';
        c.style.height = '100vh';
        c.style.display = 'block';
        c.style.background = 'transparent';
        c.style.zIndex = '10';
      }
    }

    modelSelect.addEventListener('change', () => loadModel(modelSelect.value));
    resetBtn.addEventListener('click', resetModel);
    fitToggle.addEventListener('change', () => {
      applyVideoStyles(fitToggle.checked ? 'cover' : 'contain');
    });

    // Initial laden
    loadModel('s1');

    // Sicherstellen, dass das Video sichtbar und richtig skaliert ist
    function syncSizing() {
      applyVideoStyles(fitToggle.checked ? 'cover' : 'contain');
    }
    window.addEventListener('resize', syncSizing);
    window.addEventListener('orientationchange', syncSizing);
    document.addEventListener('DOMContentLoaded', syncSizing);
    document.addEventListener('arjs-video-loaded', syncSizing);
    setTimeout(syncSizing, 800);
  </script>
</body>
</html>
